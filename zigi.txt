import datetime  # To get the date and time
import os  # To open files
import subprocess  # To open files
import time  # To calculate time
import webbrowser  # To open websites
from tkinter import *  # For the graphics
import pyjokes  # For some really bad jokes
import pyttsx3  # To convert text into speech
import speech_recognition as sr  # To convert speech into text
import wikipedia  # To get information from wikipedia
from playsound import playsound  # To play sound

name_file = open("Assistant_name", "r")
name_assistant = name_file.read()

engine = pyttsx3.init('sapi5')
voices = engine.getProperty('voices')
engine.setProperty('voice', voices[1].id)


def speak(text):
    engine.say(text)
    print(name_assistant + " : " + text)
    engine.runAndWait()


def get_audio():
    r = sr.Recognizer()

    with sr.Microphone() as source:

        print("Listening")
        playsound("future_sms.wav")
        audio = r.listen(source, phrase_time_limit=6)
        playsound("assistant_off.wav")
        print("Stop.")

    try:
        text = r.recognize_google(audio, language='en-US')
        print('You: ' + ': ' + text)
        return text
    except:
        return "None"


def wishme():
    hour = datetime.datetime.now().hour

    if 0 <= hour < 12:

        speak("Hello,Good Morning")

    elif 12 <= hour < 18:

        speak("Hello,Good Afternoon")

    else:

        speak("Hello,Good Evening")


def note(text):
    Date = datetime.datetime.now()
    file_name = str(Date).replace(":", "-") + "-note.txt"

    with open(file_name, "w") as f:
        f.write(text)

    subprocess.Popen(["notepad.exe", file_name])


def date():
    now = datetime.datetime.now()
    month_name = now.month
    day_name = now.day
    month_names = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October',
                   'November', 'December']
    ordinalnames = ['1st', '2nd', '3rd', ' 4th', '5th', '6th', '7th', '8th', '9th', '10th', '11th', '12th', '13th',
                    '14th', '15th', '16th', '17th', '18th', '19th', '20th', '21st', '22nd', '23rd', '24rd', '25th',
                    '26th', '27th', '28th', '29th', '30th', '31st']

    speak("Today is " + month_names[month_name - 1] + " " + ordinalnames[day_name - 1] + '.')


wishme()


# noinspection PyBroadException
def process_audio():
    run = 1
    if __name__ == '__main__':
        while run == 1:

            app_string = ["open word", "open powerpoint", "open excel", "open chrome"]
            app_link = [r'\Word.lnk', r'\PowerPoint.lnk',
                        r'\Excel.lnk', r'\Zoom.lnk', r'\Google Chrome.lnk']
            app_dest = r'C:\ProgramData\Microsoft\Windows\Start Menu\Programs'

            statement = get_audio().lower()
            results = ''
            run += 1

            if "hello" in statement or "hi" in statement:
                wishme()

            if "good bye" in statement or "ok bye" in statement or "stop" in statement:
                speak('Your personal assistant ' + name_assistant + ' is shutting down, Good bye')
                screen.destroy()
                break

            if 'wikipedia' in statement:
                try:

                    speak('Searching Wikipedia...')
                    statement = statement.replace("wikipedia", "")
                    results = wikipedia.summary(statement, sentences=3)
                    speak("According to Wikipedia")
                    wikipedia_screen(results)
                except:
                    speak("Error")

            if 'joke' in statement:
                speak(pyjokes.get_joke())

            if 'open youtube' in statement:
                webbrowser.open_new_tab("https://www.youtube.com")
                speak("youtube is open now")
                time.sleep(5)

            if 'open google' in statement:
                webbrowser.open_new_tab("https://www.google.com")
                speak("Google chrome is open now")
                time.sleep(5)

            if 'free movies' in statement:
                webbrowser.open_new_tab("https://123moviefree.sc/home/")
                speak("Wait let me get it arranged for you")
                time.sleep(5)

            if 'shopping' in statement:
                webbrowser.open_new_tab("https://www.amazon.in/")
                speak("Here you go")
                time.sleep(5)

            if 'open gmail' in statement:
                webbrowser.open_new_tab("mail.google.com")
                speak("Google Mail open now")
                time.sleep(5)

            if 'netflix' in statement:
                webbrowser.open_new_tab("https://www.netflix.com/in/")
                speak("Netflix open now")

            if 'prime' in statement:
                webbrowser.open_new_tab("https://www.primevideo.com")
                speak("Amazon Prime Video open now")
                time.sleep(5)

            if app_string[0] in statement:
                os.startfile(app_dest + app_link[0])

                speak("Microsoft office Word is opening now")

            if app_string[1] in statement:
                os.startfile(app_dest + app_link[1])
                speak("Microsoft office PowerPoint is opening now")

            if app_string[2] in statement:
                os.startfile(app_dest + app_link[2])
                speak("Microsoft office Excel is opening now")

            if app_string[3] in statement:
                os.startfile(app_dest + app_link[4])
                speak("Google is opening now")

            if 'news' in statement:
                news = webbrowser.open_new_tab("https://timesofindia.indiatimes.com/city/delhi")
                speak('Here are some headlines from the Times of India, Happy reading')
                time.sleep(6)

            if 'cricket' in statement:
                news = webbrowser.open_new_tab("cricbuzz.com")
                speak('This is live news from cricbuzz')
                time.sleep(6)

            if 'corona' in statement:
                news = webbrowser.open_new_tab(
                    "https://www.google.com/search?sxsrf=APq-WBv942IoCEuNHREViYTk0mMM7y0kEQ:1643363513661&q=COVID-19&si=ANhW_NoJ2qnokM-_T1OcSbqtuEZwAV8ODco_30MwEyRWOUwArzTtSMsaAXvyzie2NJbqR2ArU9lgEeDiCnAWpE5J7g3rbCkHTnyk9BuZ3e8ZqO-P4YJrvy4%3D&biw=1536&bih=763&dpr=1.25")
                speak('Here are the latest covid-19 numbers')
                time.sleep(6)

            if 'time' in statement:
                str_time = datetime.datetime.now().strftime("%H:%M:%S")
                speak(f"the time is {str_time}")

            if 'date' in statement:
                date()

            if 'who are you' in statement or 'what can you do' in statement:
                speak(
                    'I am ' + name_assistant + 'your personal assistant. I am programmed to minor tasks like opening '
                                               'youtube, google chrome, gmail and search wikipedia')

            if "who made you" in statement or "who created you" in statement or "who discovered you" in statement:
                speak("I was built by Jyotiraditya and Namrata")

            if 'make a note' in statement:
                statement = statement.replace("make a note", "")
                note(statement)

            if 'note this' in statement:
                statement = statement.replace("note this", "")
                note(statement)

            speak(results)


def change_name():
    name_info = name.get()

    file = open("Assistant_name", "w")

    file.write(name_info)

    file.close()

    settings_screen.destroy()

    screen.destroy()


def change_name_window():
    global settings_screen
    global name

    settings_screen = Toplevel(screen)
    settings_screen.title("Settings")
    settings_screen.geometry("300x300")
    settings_screen.iconbitmap('set_GCU_icon.ico')

    name = StringVar()

    current_label = Label(settings_screen, text="Current name: " + name_assistant)
    current_label.pack()

    enter_label = Label(settings_screen, text="Please enter your Virtual Assistant's name below")
    enter_label.pack(pady=10)

    name_label = Label(settings_screen, text="Name")
    name_label.pack(pady=10)

    name_entry = Entry(settings_screen, textvariable=name)
    name_entry.pack()

    change_name_button = Button(settings_screen, text="Ok", width=10, height=1, command=change_name)
    change_name_button.pack(pady=10)


def info():
    info_screen = Toplevel(screen)
    info_screen.title("Info")
    info_screen.iconbitmap('5.ico')

    creator_label = Label(info_screen, text="Created by JYOTIRADITYA,NAMRATA and DEEPANSHU")
    creator_label.pack()

    age_label = Label(info_screen, text="FOR SEM PROJECT")
    age_label.pack()


def wikipedia_screen(text):
    wikipediascreen = Toplevel(screen)
    wikipediascreen.title(text)
    wikipediascreen.iconbitmap('w.ico')

    message = Message(wikipediascreen, text=text)
    message.pack()


# noinspection PyGlobalUndefined
def main_screen():
    global screen
    screen = Tk()
    screen.title(name_assistant)
    screen.geometry("812x812")
    screen.iconbitmap('1.ico')

    name_label = Label(text=name_assistant, width=300, bg="black", fg="white", font=("Calibri", 13))
    name_label.pack()

    microphone_photo = PhotoImage(file="bot.png")
    microphone_button = Button(image=microphone_photo, command=process_audio())
    microphone_button.pack(pady=10)

    settings_photo = PhotoImage(file="settings.png")
    settings_button = Button(image=settings_photo, command=change_name_window)
    settings_button.pack(pady=10)

    info_button = Button(text="Info", command=info)
    info_button.pack(pady=10)

    screen.mainloop()


main_screen()
